---
title: "(December 2021) What I've been up to recently, and what I'm working on."
date: 2021-12-25
permalink: /posts/2021/12/bp1/
tags:
  - Life
  - Ion channels
  - Molecular dynamics
---

<style>
    pre {font-size: 12;}
    h3 {font-size: 1.35em;}
    h4 {font-size: 1.2em;}

    .inline-block {
        display: inline-block;
    }

    .container {
        max-width: 100vw; 
        margin: 0;
        horizontal-align: middle;
    }
</style>

It's been a while since I've updated my blog. I'd like to share a couple updates on what I've been doing, and what I hope to accomplish within the next month. I'll start in chronological order, making note of the approximate dates when I worked on things. 

Also, my laptop is acting up right now, so I can't add links (freezes while typing every $n$ characters...). I really need a new machine, don't I. If anyone is willing to hire me, or sponsor a new machine... of course not... right? It is Christmas, after all... 


**Table of Contents**
- [Part I: Exploration and computational experiments.](#part-i-exploration-and-computational-experiments)
  - [Molecular dynamics (MD)](#molecular-dynamics-md)
    - [Introduction](#introduction)
    - [Differences between HCN and Kv channel opening mechanisms](#differences-between-hcn-and-kv-channel-opening-mechanisms)
      - [1. Different relative arrangements of the voltage-sensing domain (VSD) and pore domain (PD).](#1-different-relative-arrangements-of-the-voltage-sensing-domain-vsd-and-pore-domain-pd)
      - [2. Differences in VSD-PD ('electromechanical') coupling.](#2-differences-in-vsd-pd-electromechanical-coupling)
      - [3. Differences in opening energetics and kinetics.](#3-differences-in-opening-energetics-and-kinetics)
    - [Results of a *brief* set of MD experiments](#results-of-a-brief-set-of-md-experiments)
      - [Root Mean Squared Deviation (RMSD)](#root-mean-squared-deviation-rmsd)
      - [Root Mean Squared Fluctuation](#root-mean-squared-fluctuation)
      - [Radius of gyration (Rg)](#radius-of-gyration-rg)
      - [Pore diameter analysis with HOLE](#pore-diameter-analysis-with-hole)
    - [Network analyses with Cytoscape](#network-analyses-with-cytoscape)
    - [Closing remarks.](#closing-remarks)
- [Bayesian inference for an ion channel model](#bayesian-inference-for-an-ion-channel-model)
- [References](#references)
- [Appendix](#appendix)
  - [Script that interfaces with Cytoscape to generate and analyze RINs](#script-that-interfaces-with-cytoscape-to-generate-and-analyze-rins)

# Part I: Exploration and computational experiments. 
By July 2021, I had completed my last, pre-defense committee meeting, and was fully committed on writing my thesis. However, there were several unturned stones that were bothering me, and in the absence of both intervention and calculated reasoning, I decided to spend my newfound time away from the lab in exploring these ideas. I was initially quite confident that I could complete what I wanted to do in a couple weeks. The subtext, of course, is that I didn't, and, since none of this work will be in my thesis nor any eventual publication, I wasted several months, and continue to face the emotional, physical, and financial consequences of this series of unfortunate decisions.

Regrets aside, what did I actually accomplish in this period (roughly July through to September)? 

## Molecular dynamics (MD)

### Introduction

By this, I mean that I used [OpenMM](https://openmm.org) and mostly-default [CHARMM-GUI](https://www.charmm-gui.org/) settings to perform all-atom simulations of WT and F431A HCN2 channels. The homology models were built using the [SwissModel](https://swissmodel.expasy.org/) server from HCN1 (PDB: 5U6O, 5U6P, 6UQF, and 6UQG). These pilot experiments were inspired by those of the isolated segment of Kv1.5 channels shown in [Labro et al. (2003)](https://pubmed.ncbi.nlm.nih.gov/13679372/). This study was interesting because it focused on the *PVP* hinge motif, the first proline of which is homologous to F431 in HCN2, and showed that this first proline was required for channel opening. Their MD simulations were fairly limited, at 10 ns in duration and involving only the four S6 segments. The authors suggested that the first proline in the *PVP* motif introduces a kink that allows the pore to dilate upon voltage-sensor activation. 

<br>
<figure>
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/Labro-PVP sequence.jpg?raw=true"
      alt="Alignment of the S6 segment of Kv channels."
      title="Alignment of the S6 segment of Kv channels." width="50%" height="50%"
      style="horizontal-align:middle"
    />
  </center>
  <figcaption>
    <b> Fig. 1 - Alignment of the S6 segment of Kv channels. </b>
    <br>
    <p> Sequence alignment of Kv channels around the *PVP* motif, showing its conservation. Figure reproduced without permission from <a href="https://pubmed.ncbi.nlm.nih.gov/13679372/">Labro et al. (2003)</a>. </p>
  </figcaption>
</figure>
<br>

### Differences between HCN and Kv channel opening mechanisms
However, the mechanism of pore opening likely differ between HCN and Kv channels. There are several reasons for this, including:

#### 1. Different relative arrangements of the voltage-sensing domain (VSD) and pore domain (PD).
In HCN channels, VSDs interact with PDs of the *same* subunit, whereas in Kv channels, VSDs interact with PDs of *adjacent* subunits. These configurations are called 'non-domain swapped' and 'domain-swapped,' respectively. 

<br>
<figure>
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/Barros-swapped.png?raw=true"
      alt="Comparison of domain-swapped and non-domain-swapped arrangements."
      title="Comparison of domain-swapped and non-domain-swapped arrangements." width="60%" height="60%"
      style="horizontal-align:middle"
    />
  </center>
  <figcaption>
    <b> Fig. 2 - Comparison of domain-swapped and non-domain-swapped arrangements. </b>
    <br>
    <p> Pores are coloured blue, S4-S5 linkers in magenta, and the voltage-sensing domain (VSD) in black. Orange marks positively charged S4 residues. Views are from the membrane plane (top) and from the cytosolic side (bottom). Figure reproduced without permission from <a href="https://pubmed.ncbi.nlm.nih.gov/32351384/">Barros et al. (2020)</a>. </p>
  </figcaption>
</figure>
<br>

#### 2. Differences in VSD-PD ('electromechanical') coupling.
Due to the different structural arrangements of the PD and VSD, the mechanism by which voltage-sensing is coupled to the pore is also different. However, the most striking evidence of this is that HCN channels activate upon hyperpolarization, rather than depolarization like most Kv channels, despite HCN channels being members of the latter. In fact, gating currents also show that the S4 segments also move similarly upon changes in membrane potential (e.g. [Mannikko et al. (2002)](https://pubmed.ncbi.nlm.nih.gov/12397358/), Ryu et al. (2012)). 

#### 3. Differences in opening energetics and kinetics.
The current model of HCN channel activation is that, in the depolarized state, the VSDs push the pore closed and are thus autoinhibitory for channel opening. This is supported by structures of HCN1 and HCN4  that show tight planar arrays formed by S4, S5, and S6 ([Lee and MacKinnon (2017)](https://pubmed.ncbi.nlm.nih.gov/28086084/), [Saponaro et al. (2021)](https://pubmed.ncbi.nlm.nih.gov/34166608/)). The next key idea comes from my Master's lab in an alanine/valine scan of 20-odd residues in the distal S6 of HCN2. In this study, Vincenzo ('Enzo') Macri, a PhD alum, found that the majority of mutants exhibited compromised opening ([Macri et al. (2009)](https://pubmed.ncbi.nlm.nih.gov/19269964/)). In contrast, similar studies in *Shaker* Kv channels showed the opposite, i.e. that most mutations in the distal pore resulted in greater opening at rest. A straightforward interpretation of these observations is that the energetics of pore opening differ between *Shaker* and HCN: the open state is intrinsically *less* favourable in *Shaker*, but *more* favourable in HCN chanels. 

Hyperpolarization-dependent activation in HCN channels can therefore be explained as follows. Though the open state of the pore is energetically favoured, it cannot open upon depolarization due to autoinhibition from the VSDs, which pack against and close the pore at rest (depolarization). However, when displaced by hyperpolarization, VSD-PD contact is weakened, allowing the pore to *relax* into an open state. In contrast, opening of Kv channels is *active* and requires S4s the 'pull' the S6 gate open (hence, 'electromechanical'), whereas closing is passive. 

Below are some additional, noteworthy observations regarding electromechanical coupling in HCN and Kv channels.

**a. Kv channels require an S4-S5 linker, but not HCN channels.**

Electromechanical coupling in Kv channels requires a short, intracellular linker between the S4 and S5 ('S4-S5 linker'), presumably to transduce the aforementioned force of 'pulling.' Conversely, deletion or truncation of the S4-S5 linker does not impair normal gating in HCN channels. In fact, this appears to be the case for a number of '[non-domain swapped](#different-relative-arrangements-of-the-voltage-sensing-domain-vsd-and-pore-domain-pd)' channels, including [hERG and rEAG (Lorinczi et al., 2015)](https://pubmed.ncbi.nlm.nih.gov/25818916/). 

**b. Weak VSD-PD coupling.**

VSD-PD coupling is *very* weak in HCN channels! For one, kinetic models have predicted allosteric coupling factors that are at least 100 times less than those of *Shaker* ([Ryu et al. (2012)](https://pubmed.ncbi.nlm.nih.gov/23071265/), [Flynn et al. (2018)](https://pubmed.ncbi.nlm.nih.gov/30076228/)). Secondly, many mutations of the S4 and S5 cause raise baseline conductance at positive voltages, or even result in constitutively open channels (e.g. [Cheng et al. (2007)](https://pubmed.ncbi.nlm.nih.gov/17578902/), [Wemhöner et al. (2012)](https://pubmed.ncbi.nlm.nih.gov/23048023/), [Ramentol et al. (2020)](https://pubmed.ncbi.nlm.nih.gov/32184399/)). This may seem surprising, given the result of mutations in the distal S6, but actually, this actually has a very intuitive explanation. 

Given the favourable energetics of pore opening, channels would be expected to open at positive voltages in the absence of either: (1) voltage-sensing or (2) VSD-PD interaction. Since VSD-PD coupling is weak and required for deactivation, but not activation, channel closing is easily compromised by relatively small perturbations. Perhaps the best demonstration of weak VSD-PD coupling is the ability to convert HCN channels into depolarization-activated channels with just a few mutations at the S4-S5 interface (Ramentol et al. (2020)). 

However, there still remains a lot of work to be done. Personally, I've always been more interested in the *kinetic* side of the story, as there are a number of unique kinetic features of HCN channels. In fact, I could write another blog post about these. For example, while HCN and hERG are non-domain swapped channels that don't require their S4-S5 linkers for normal voltage-gating, hERG not only exhibits depolarization-dependent activation, but also opens much faster than HCN2/HCN4 - less than a second and several seconds, respectively. 

So, VSD-PD coupling isn't the whole story! To explain these differences, we need to (re)-visit the S5 and S6. In recent years, we have uncovered much about how the S4 and S5 communicate, and how C-terminal regions of the channel interact with the VSD, but much remains unknown about the S6. How does it open? How does it close? I attempted to answer the latter in my Master's thesis (I'll add a link to it in six or so months when it's finally published). 

### Results of a *brief* set of MD experiments
As stated above, I performed a series of MD experiments using homology models of WT and F431A HCN2 channels. As mentioned above, F431 is homologous to the first proline in the *PVP* hinge motif. In HCN channels, this pheylalanine is located in the distal S6 and is located across all isoforms. My Master's thesis focused on understanding the biophysics of the F431A mutant using electrophysiology and mathematical modelling, but these methods naturally come short in providing a truly molecular interpretation. 

Like Labro et al. (2003), my simulations were 10 ns long in duration (following appropriate minimization and equilibration), but whereas Labro and colleagues only simulated the S5 segments, I performed all-atom simulations in which the channels were embedded and simulated within a POPC bilayer. 

For the sake of brevity (there's still *much* more to cover in this blog post...), I will only show summary metrics of these experiments. I show both the summary figures and relevant (partial) code used to generate the data, but not necessarily the visualizations. All code is written in Python 3.7 and assumes the follow packages are imported, and that the trajectory is centerd and aligned:

<pre style='color:#d1d1d1;background:#000000;'><span style='color:#e66170; font-weight:bold; '>import</span> numpy <span style='color:#e66170; font-weight:bold; '>as</span> np 
<span style='color:#e66170; font-weight:bold; '>import</span> pandas <span style='color:#e66170; font-weight:bold; '>as</span> pd 
<span style='color:#e66170; font-weight:bold; '>import</span> MDAnalysis <span style='color:#e66170; font-weight:bold; '>as</span> mda 

<span style='color:#e66170; font-weight:bold; '>def</span> RemoveOverallMovement<span style='color:#d2cd86; '>(</span>
    u<span style='color:#d2cd86; '>:</span> mda<span style='color:#d2cd86; '>.</span>Universe<span style='color:#d2cd86; '>,</span> u2<span style='color:#d2cd86; '>:</span> mda<span style='color:#d2cd86; '>.</span>Universe<span style='color:#d2cd86; '>,</span> out_path<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>str</span>
<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    <span style='color:#9999a9; '>"""Align a trajectory to its first frame to remove overall movements</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Args:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u (mda.Universe): coordinates and trajectory </span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u2 (mda.Universe): copy of `u`</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;out_path (str): filename for saved alignment (dcd file)</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Returns:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mda.Universe: aligned mda Universe</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;"""</span>
    u<span style='color:#d2cd86; '>.</span>trajectory<span style='color:#d2cd86; '>[</span><span style='color:#00dddd; '>-</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span>
    u2<span style='color:#d2cd86; '>.</span>trajectory<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span> 
    
    align<span style='color:#d2cd86; '>.</span>AlignTraj<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>,</span> u2<span style='color:#d2cd86; '>,</span> select<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'name CA'</span><span style='color:#d2cd86; '>,</span> filename<span style='color:#d2cd86; '>=</span>out_path<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>run<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>return</span> u 
</pre>
<!--Created using ToHtml.com on 2021-12-25 14:42:50 UTC -->

#### Root Mean Squared Deviation (RMSD)
RMSDs were computed for the entire trajectory using the backbone carbons of each residue, and then averaged across the four subunits. RMSD trajectories are often used to estimate how close to steady-state a system is: the higher the RMSD, the more 'dynamic' the system and the further it is from steady-state. In my simulations, RMSDs seem to stabilize, or be very close to stabilizing, by the end of 10 ns. However, the S4 segment of 'F431A_5u6o' seems to be substantially more dynamic than other models simulated (see legend of Figure 2 for an explanation of the naming). This could indicate that the F431A mutation, despite being located on the S6, 

<br>
<figure>
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/MD-rmsd.png?raw=true"
      alt="RMSDs of WT and F431A HCN2 channels.."
      title="RMSDs of WT and F431A HCN2 channels." width="90%" height="90%"
      style="horizontal-align:middle"
    />
  </center>
  <figcaption>
    <b> Fig. 4 - RMSDs of WT and F431A HCN2 channels. </b>
    <br>
    <p> RMSD over the 10-ns trajectory is shown for the full protein ('Full') and individually for segments S4, S5, and S6. RMSD values were averaged across subunits. Colours correspond to different protein templates: WT HCN2 ('wt_5u6o' and 'wt_6uqg'), F431A HCN2 ('F431A_5u6o' and 'F431A_6uqg'). The suffices correspond to the RCSB IDs of models used as homology templates, where 5U6O corresponds to the closed HCN1 channel (Lee and MacKinnon, 2017) and 6UQG to constitutively open HCN1 mutant (<a href="https://pubmed.ncbi.nlm.nih.gov/31787376/">Lee and MacKinnon, 2019</a>). </p>
  </figcaption>
</figure>
<br>

<pre style='color:#d1d1d1;background:#000000;'><span style='color:#e66170; font-weight:bold; '>def</span> do_RMSD<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>:</span> mda<span style='color:#d2cd86; '>.</span>Universe<span style='color:#d2cd86; '>,</span> selections<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>list</span><span style='color:#d2cd86; '>,</span> sel_names<span style='color:#d2cd86; '>=</span><span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> weights<span style='color:#d2cd86; '>=</span>None<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    <span style='color:#9999a9; '>"""perform RMSD on each frame of u.trajectory</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Args:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u (mda.Universe): coordinates and trajectory</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;selections (list): list of strings conforming to MDAnalysis' atom selection language, e.g. 'resid 1-50' </span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;sel_names (list): list of strings representing names of groups in `selections` used as column headers for output dataframe. If empty, uses default numbers.</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;weights (None or str, optional): weighting for RMSD calculation, of same length as number of particles in corresponding AtomGroup. Use 'mass' for weights of particle weights. Defaults to None.</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Returns:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pd.DataFrame: RMSD values </span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;"""</span>
    <span style='color:#9999a9; '># universe is automatically translated/centered </span>
    R <span style='color:#d2cd86; '>=</span> rms<span style='color:#d2cd86; '>.</span>RMSD<span style='color:#d2cd86; '>(</span>
        u<span style='color:#d2cd86; '>,</span> u<span style='color:#d2cd86; '>,</span> select<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'backbone'</span><span style='color:#d2cd86; '>,</span> weights<span style='color:#d2cd86; '>=</span>weights<span style='color:#d2cd86; '>,</span>
        groupselections<span style='color:#d2cd86; '>=</span>selections<span style='color:#d2cd86; '>,</span> ref_frame<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>0</span>
    <span style='color:#d2cd86; '>)</span>
    
    R<span style='color:#d2cd86; '>.</span>run<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#9999a9; '># column names for output dataframe</span>
    cols <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>'Frame'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'Time (ns)'</span><span style='color:#d2cd86; '>]</span>
    <span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>sel_names<span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>&lt;</span> <span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>:</span>
        cols<span style='color:#d2cd86; '>.</span>extend<span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>list</span><span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>range</span><span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>selections<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
    <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
        cols<span style='color:#d2cd86; '>.</span>extend<span style='color:#d2cd86; '>(</span>sel_names<span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>return</span> pd<span style='color:#d2cd86; '>.</span>DataFrame<span style='color:#d2cd86; '>(</span>R<span style='color:#d2cd86; '>.</span>rmsd<span style='color:#d2cd86; '>,</span> columns<span style='color:#d2cd86; '>=</span>cols<span style='color:#d2cd86; '>)</span>
</pre>
<!--Created using ToHtml.com on 2021-12-25 14:43:55 UTC -->

#### Root Mean Squared Fluctuation
The RMSF is very similar to the RMSD if you imagine averaging the RMSD for each timepoint. The RMSF measures the movement of each residue throughout the trajectory. Comparing the same simulations as above, we see that the RMSFs are very similar, although 'F431A_5u6o' seems to be more dynamic between S4-S5 and just distal to the S6. 

<br>
<figure>
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/MD-rmsf.png?raw=true"
      alt="RMSFs of WT and F431A HCN2 channels.."
      title="RMSFs of WT and F431A HCN2 channels." width="90%" height="90%"
      style="horizontal-align:middle"
    />
  </center>
  <figcaption>
    <b> Fig. 5 - RMSFs of WT and F431A HCN2 channels. </b>
    <br>
    <p> RMSFs over the 10-ns trajectory is shown for WT HCN2 ('wt_5u6o' and 'wt_6uqg') and F431A HCN2 ('F431A_5u6o' and 'F431A_6uqg'). See the legend of Figure 4 for an explanation of suffices. </p>
  </figcaption>
</figure>
<br>

<pre style='color:#d1d1d1;background:#000000;'>
<span style='color:#e66170; font-weight:bold; '>def</span> do_RMSF<span style='color:#d2cd86; '>(</span>
    u<span style='color:#d2cd86; '>:</span> mda<span style='color:#d2cd86; '>.</span>Universe<span style='color:#d2cd86; '>,</span> out_path<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>,</span> 
    save_avg_pdb<span style='color:#d2cd86; '>=</span>False<span style='color:#d2cd86; '>,</span> save_avg_traj<span style='color:#d2cd86; '>=</span>False<span style='color:#d2cd86; '>,</span> 
    show<span style='color:#d2cd86; '>=</span>True<span style='color:#d2cd86; '>,</span> out<span style='color:#d2cd86; '>=</span>False
<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    <span style='color:#9999a9; '>"""Compute RMSF over trajectory relative to average structure</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Args:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u (mda.Universe): coordinates and trajectory loaded with MDAnalysis</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;out_path (str): folder to hold output files </span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;save_avg_pdb (bool, optional): whether to save average pdb. Defaults to False.</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;save_avg_traj (bool, optional): whether to save average-aligned trajectory. Defaults to False.</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;show (bool, optional): whether to plot RMSF. Defaults to True.</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;out (bool, optional): whether to write PDB coloured by RMSF (B factors). Defaults to False.</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Returns:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;np.ndarray: 1D array of RMSF values for each frame </span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;"""</span>
    <span style='color:#9999a9; '># create average structure</span>
    avg <span style='color:#d2cd86; '>=</span> align<span style='color:#d2cd86; '>.</span>AverageStructure<span style='color:#d2cd86; '>(</span>
        u<span style='color:#d2cd86; '>,</span> u<span style='color:#d2cd86; '>,</span> select<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'protein and name CA'</span><span style='color:#d2cd86; '>,</span> ref_frame<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>0</span>
    <span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>run<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>if</span> save_avg_pdb<span style='color:#d2cd86; '>:</span>
        avg<span style='color:#d2cd86; '>.</span>atoms<span style='color:#d2cd86; '>.</span>write<span style='color:#d2cd86; '>(</span>out_path <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"_avg.pdb"</span><span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Saved averaged PDB to %s_avg.pdb"</span> <span style='color:#00dddd; '>%</span> out_path<span style='color:#d2cd86; '>)</span>
    
    <span style='color:#9999a9; '># align backbone of average structure and trajectory  </span>
    <span style='color:#e66170; font-weight:bold; '>if</span> save_avg_traj<span style='color:#d2cd86; '>:</span>
        align<span style='color:#d2cd86; '>.</span>AlignTraj<span style='color:#d2cd86; '>(</span>
            u<span style='color:#d2cd86; '>,</span> avg<span style='color:#d2cd86; '>.</span>universe<span style='color:#d2cd86; '>,</span> select<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'protein and name CA'</span><span style='color:#d2cd86; '>,</span>
            filename <span style='color:#d2cd86; '>=</span> out_path <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"_avg_aligned.dcd"</span>
        <span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>run<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Saved average-aligned trajectory to %s_avg_aligned.dcd"</span> <span style='color:#00dddd; '>%</span> out_path<span style='color:#d2cd86; '>)</span>
    <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
        align<span style='color:#d2cd86; '>.</span>AlignTraj<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>,</span> avg<span style='color:#d2cd86; '>.</span>universe<span style='color:#d2cd86; '>,</span> select<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'protein and name CA'</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>run<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#9999a9; '># compute rmsf </span>
    c_alphas <span style='color:#d2cd86; '>=</span> u<span style='color:#d2cd86; '>.</span>select_atoms<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>'protein and name CA'</span><span style='color:#d2cd86; '>)</span>
    R <span style='color:#d2cd86; '>=</span> rms<span style='color:#d2cd86; '>.</span>RMSF<span style='color:#d2cd86; '>(</span>c_alphas<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>run<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>if</span> show<span style='color:#d2cd86; '>:</span>
        plt<span style='color:#d2cd86; '>.</span>plot<span style='color:#d2cd86; '>(</span>c_alphas<span style='color:#d2cd86; '>.</span>resids<span style='color:#d2cd86; '>,</span> R<span style='color:#d2cd86; '>.</span>rmsf<span style='color:#d2cd86; '>)</span>
        plt<span style='color:#d2cd86; '>.</span>xlabel<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>'Residue number'</span><span style='color:#d2cd86; '>)</span>
        plt<span style='color:#d2cd86; '>.</span>ylabel<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>'RMSF ($</span><span style='color:#008080; '>\A</span><span style='color:#00c4c4; '>A$)'</span><span style='color:#d2cd86; '>)</span>
        plt<span style='color:#d2cd86; '>.</span>show<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#9999a9; '>## add empty attribute for all atoms</span>
    <span style='color:#e66170; font-weight:bold; '>if</span> out<span style='color:#d2cd86; '>:</span>
        np<span style='color:#d2cd86; '>.</span>save<span style='color:#d2cd86; '>(</span>out_path <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"rmsf.npy"</span><span style='color:#d2cd86; '>,</span> R<span style='color:#d2cd86; '>.</span>rmsf<span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"RMSF saved to %s_rmsf.npy"</span> <span style='color:#00dddd; '>%</span> out_path<span style='color:#d2cd86; '>)</span>
        
        u<span style='color:#d2cd86; '>.</span>add_TopologyAttr<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>'tempfactors'</span><span style='color:#d2cd86; '>)</span> 
        protein <span style='color:#d2cd86; '>=</span> u<span style='color:#d2cd86; '>.</span>select_atoms<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>'protein'</span><span style='color:#d2cd86; '>)</span> <span style='color:#9999a9; '># select protein atoms</span>
        <span style='color:#e66170; font-weight:bold; '>for</span> residue<span style='color:#d2cd86; '>,</span> r_value <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>zip</span><span style='color:#d2cd86; '>(</span>protein<span style='color:#d2cd86; '>.</span>residues<span style='color:#d2cd86; '>,</span> R<span style='color:#d2cd86; '>.</span>rmsf<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
            residue<span style='color:#d2cd86; '>.</span>atoms<span style='color:#d2cd86; '>.</span>tempfactors <span style='color:#d2cd86; '>=</span> r_value
        u<span style='color:#d2cd86; '>.</span>atoms<span style='color:#d2cd86; '>.</span>write<span style='color:#d2cd86; '>(</span>out_path <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>'_rmsf.pdb'</span><span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"RMSF-coloured PDB saved to %s_rmsf.pdb"</span> <span style='color:#00dddd; '>%</span> out_path<span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>return</span> R<span style='color:#d2cd86; '>.</span>rmsf 
</pre>
<!--Created using ToHtml.com on 2021-12-25 14:45:25 UTC -->

#### Radius of gyration (Rg)
Radius of gyration (Rg) is a familiar concept to physicists, but perhaps not for most (traditional) biologists. Wikipedia describes it as follows:

<blockquote cite="https://en.wikipedia.org/wiki/Radius_of_gyration" style="background-color:#3d3d3d; color:#ffffff"> the axis of rotation is defined as the radial distance to a point which would have a moment of inertia the same as the body's actual distribution of mass, if the total mass of the body were concentrated there </blockquote>

<br>
<figure>
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/MD-rgyr.png?raw=true"
      alt="Rg of WT and F431A HCN2 channels.."
      title="Rg of WT and F431A HCN2 channels." width="90%" height="90%"
      style="horizontal-align:middle"
    />
  </center>
  <figcaption>
    <b> Fig. 6 - Radii of gyration of WT and F431A HCN2 channels. </b>
    <br>
    <p> Radii of gyration over the 10-ns trajectory is shown for WT HCN2 ('wt_5u6o' and 'wt_6uqg') and F431A HCN2 ('F431A_5u6o' and 'F431A_6uqg'). See the legend of Figure 4 for an explanation of suffices. Radii of gyration were averaged over each subunit and normalized by subtracting the mean of each time series. </p>
  </figcaption>
</figure>
<br>

<pre style='color:#d1d1d1;background:#000000;'><span style='color:#e66170; font-weight:bold; '>def</span> do_Rg<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>:</span> mda<span style='color:#d2cd86; '>.</span>Universe<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    <span style='color:#9999a9; '>"""Compute radius of gyration of backbone over trajectory</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Args:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u (mda.Universe): coordinates and trajectory</span>
<span style='color:#9999a9; '></span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;Returns:</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pd.DataFrame: radius of gyration with column of frames </span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;"""</span>
    prot <span style='color:#d2cd86; '>=</span> u<span style='color:#d2cd86; '>.</span>select_atoms<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>'protein and backbone'</span><span style='color:#d2cd86; '>)</span>
    
    frames <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
    Rg <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
    <span style='color:#e66170; font-weight:bold; '>for</span> ts <span style='color:#e66170; font-weight:bold; '>in</span> u<span style='color:#d2cd86; '>.</span>trajectory<span style='color:#d2cd86; '>:</span>
        Rg<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span>prot<span style='color:#d2cd86; '>.</span>radius_of_gyration<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
        frames<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span>ts<span style='color:#d2cd86; '>.</span>frame<span style='color:#d2cd86; '>)</span>
        
    <span style='color:#e66170; font-weight:bold; '>return</span> pd<span style='color:#d2cd86; '>.</span>DataFrame<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>[</span>frames<span style='color:#d2cd86; '>,</span> Rg<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> columns<span style='color:#d2cd86; '>=</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"Frame"</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>"Rg"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
</pre>
<!--Created using ToHtml.com on 2021-12-25 15:13:04 UTC -->

#### Pore diameter analysis with [HOLE](http://www.holeprogram.org/)
The last of the "MD-specific" analyses I did was use HOLE to measure pore widths for each simulation. HOLE is an interesting program with a lot of history in the ion channel field. I don't really know how it works, but HOLE is used extensively to compute the width of ion channel pores, which I believe are located in structures using properties such as residue size and hydrophobicity. Some more recent tools have been developed, a bunch of which are available on web servers, e.g. [MOLEonline](https://mole.upol.cz/). I don't find these tools particularly novel or innovative, but I admittedly also don't understand them very well. Another software of this variety is the [Channel Annotation Package (CHAP)](https://www.channotation.org/) which was developed by Klesse and colleagues at Oxford ([Klesse et al. (2019)](https://doi.org/10.1016/j.jmb.2019.06.003)), although I first heard of it from [Rao et al. (2019)](https://www.pnas.org/content/116/28/13989). I like CHAP, since it's based on molecular dynamics simulations, and even tried it on my own several years ago, confirming the authors' results on HCN [Rao et al. (2019)](https://www.pnas.org/content/116/28/13989). 

<br>
<figure>
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/MD-last hole profiles.png?raw=true"
      alt="Pore profiles of WT and F431A HCN2 channels.."
      title="Pore profiles of WT and F431A HCN2 channels." width="90%" height="90%"
      style="horizontal-align:middle"
    />
  </center>
  <figcaption>
    <b> Fig. 7 - Pore profiles of WT and F431A HCN2 channels. </b>
    <br>
    <p> Pore profiles over the 10-ns trajectory is shown for WT HCN2 ('wt_5u6o' and 'wt_6uqg') and F431A HCN2 ('F431A_5u6o' and 'F431A_6uqg'). See the legend of Figure 4 for an explanation of suffices. The pore profiles are roughly identical, suggesting that the mutation doesn't strongly affect pore radius. Pore widths are computed using the last frame of each trajectory. </p>
  </figcaption>
</figure>
<br>

### Network analyses with Cytoscape
After the initial MD analyses seemed to not give a clear indication of how F431A affected the dynamics of HCN2 channels, I turned to network-based analyses. An intuitive representation of a protein is as a graph with residues as nodes and bonds or interactions as edges. I used [Cytoscape](https://cytoscape.org/) and [RINalyzer](https://rinalyzer.de/) to build and analyze these graphs (called 'Residue Interaction Networks,' or RINs for short). The motivation was fairly simple: there may be effects of the mutation that are difficult to 'see' from movement-based metrics (e.g. RMSD, RMSF, etc.) alone. Indeed, some groups have combined MD and network analysis to look at allosteric signaling within proteins (e.g. [Fernandez-Marino et al. (2018)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6170002/) and [Kang et al. (2020)](https://www.science.org/doi/10.1126/sciadv.abd6798). 

This is totally irrelevant, but Po Wei ("Billy") Kang, the first author of the second paper, spoke at a meeting I attended in 2019. At the time, I was very much insulated from other ion channel researchers (still am, I guess). His presentation then was like a conversation you have during the day to which you think of a good reply hours or days after the conversation. Anyway, what I'm trying to say is that his work is superb. Somewhat reminds me of giants like Francisco Bezanilla or Clay Armstrong, but what do I know. 

Continuing on from where I left off - the application of network analysis on RINs. Network science is a very interesting developed field, and a lot of the results are intuitively integrated with fields like probability, electrical engineering, and dynamical systems. However, I only looked at a small subset of network science - network centrality. Centrality metrics all try to capture how 'important' a given node or edge is within a network. There are many ways to calculate centrality, including the number of neighbours a node has, the number of shortest paths that traverse a node, and similar definitions for edges. I started by computing different centrality metrics for each model (e.g. 'WT_5u6o', 'F431A_5u6o', etc.) to see whether there were differences between WT and F431A. Another aside - I know that this sounds like confirmation bias. It is, sort of. But I think about it as exploratory analysis, in the sense that I don't know much about my system (network properties of the protein) and that I have a bunch of drill bits (centrality metrics) that fit slightly differently (address different aspects of the network). So, this is more about tool selection. 

<br>
<figure class="inline-block">
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/NetCent-5u6o_hcn2_Individual.png?raw=true"
      alt="Centrality metrics for WT_5u6o"
      title="Centrality metrics for WT_5u6o." width="100%" height=auto
    />
  </center>
  <figcaption> <b> Fig. 8 - Individual centrality metrics for 'wt_5u6o'. </b>
  <p> Cenrality metrics were computed for the last frame of each trajectory and averaged over subunits. Labels on the x-axis correspond to residue numbers. Explanations of each centrality measure can be found at <a href="https://www.centiserver.org/centrality/list/">CentiServer</a>.</p>
  </figcaption>
</figure>
<br>


<div class="container">
    <figure>
        <center> <img 
        src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/NetCent-5u6o_hcn2_Grouped.png?raw=true"
        alt="Centrality metrics for WT_5u6o"
        title="Centrality metrics for WT_5u6o." width="90%" height=auto
        />
        </center>
    </figure>
    <figure >
        <center> <img 
        src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/NetCent-6uqf_hcn2_Grouped.png?raw=true"
        alt="Centrality metrics for WT_6uqf"
        title="Centrality metrics for WT_6uqf." width="90%" height=auto
        /> </center>
    </figure>
    <figure >
        <center> <img 
        src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/NetCent-6uqg_hcn2_Grouped.png?raw=true"
        alt="Centrality metrics for WT_6uqg"
        title="Centrality metrics for WT_6uqg." width="90%" height=auto
        /> </center>
    <figcaption> <b> Fig. 9 - Grouped centrality metrics. </b>
    <p> Grouped centrality metrics for WT_5u6o (top), WT_6uqf (middle) and WT_6uqg (bottom). Metrics were grouped based on apparent similarity as seen in plots such as Figure 8. Metric values were normalized in the range $[0, 1]$. Black circles indicate values in the 90th percentile. </p> </figcaption>
    </figure>
</div>

The similarity between several centrality metrics motivated me to normalize and compare them in groups (Figure 9). However, betweenness centrality was consistently fairly different from the other metrics. Other metrics, such as clustering coefficient and eccentricity, are computed in similar ways to those in Figure 9 and were therefore not considered further (i.e. they represent similar types of information). The plots above were all for WT models, as I've left out analyses of F431A for brevity. However, it turns out that betweenness centrality (BC) could distinguish between F431A and WT models. In other studies, BC has been used to analyze allosteric signaling pathways (e.g. Kang et al. (2020), and [this Github repo](https://github.com/delemottelab/allosteric-pathways)).

<figure class="inline-block">
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/Net-DeltaAvgBCA.png?raw=true"
      alt="Comparison of betweenness centrality for WT and F431A models."
      title="Comparison of betweenness centrality for WT and F431A models." width="100%" height=auto
    />
  </center>
  <figcaption> <b> Fig. 10 - Comparison of betweenness centrality for WT and F431A models. </b>
  <p> Normalized centrality values were computed for each model, and then subtracted according to the labels on top of each subplot. Normalization was done by computing Z-scores: subtracting the mean and dividing the standard deviation of each dataset. A negative difference value ($\Delta Z_{BC}$) corresponds to lower betweenness centrality in the leftward model of each subtraction. Thus, comparing F431A_5u6o and WT_5u6o, the mutation results in a loss of a central residue in the distal S6 and a significant gain in centrality for a nearby upstream residue. </p> </figcaption>
</figure>

Figure 10 shows differenced [Z-scores](https://en.wikipedia.org/wiki/Standard_score) of betweenness centrality between different pairs of models. The plot that stands out most to me is the top left, which shows the difference between F431A_5u6o and WT_5u6o, which were both built using a closed HCN1 channel as template. This plot shows a substantial decrease in centrality of a residue in the distal S6, and a concomitant increase in centrality of another located very closeby, but slightly higher on the S6. These residues, it turns out, are at indices 431 and 428, respectively. It seems to suggest that the loss of allosteric function in F431A is being compensated by residue 428. In fact, residue 428 is a tyrosine - another bulky, aromatic residue! Could this be a coincidence? 

This brings me back to the very beginning of my Master's thesis. I expound on this idea more in my thesis, but I essentially started off thinking that what F431 did was to mediate contact between the S5 and S6 so that packing forces from the S4 would be effectively transmitted to the pore. 

### Closing remarks. 
That concludes most of this section. I just want to note that I felt like I learned a lot about other aspects of programming from this project, including high-performance programming for molecular dynamics simulation in OpenMM (granted, the code to do so was already laid out for me) and using a REST API (Cytoscape). See [Script that interfaces with Cytoscape to generate and analyze RINs](#script-that-interfaces-with-cytoscape-to-generate-and-analyze-rins) for the full script I used to automate RIN creation for dozens of protein files, analyze their networks in Cytoscape, and write outputs to .PDB and .CSV files. 

<figure class="inline-block">
  <center>
    <img 
      src="https://github.com/haganenoneko/haganenoneko.github.io/blob/master/_posts/figs/2021-12-25-figs/NetCent-5u6o_hcn2+F431A_1n.png?raw=true"
      alt="F431 and its first neighbours."
      title="F431 and its first neighbours." width="100%" height=auto
    />
  </center>
  <figcaption> <b> Fig. 12 - F431 and its first neighbours. </b>
  <p> Close-up view of the C-terminal S4 (right), S5, and S6 (left) for 'WT_5u6o.' The bottom of the image corresponds to the cytosolic direction. F431 and its first neighbours are shown as sticks. Residues (of the full protein) are coloured according to their betweenness centrality, where higher values are indicated by brighter colours. Note how the majority of the protein is uniformly dark, besides residues near F431. </p> </figcaption>
</figure>

# Bayesian inference for an ion channel model
Well. I also did some of this. But it's 9AM Christmas morning and I haven't slept at all, writing this post. I should probably stop here. I don't know if or when I'll continue this, but for now, happy holidays. 

# References
Barros F, de la Peña P, Domínguez P, Sierra LM, Pardo LA. The EAG Voltage-Dependent K+ Channel Subfamily: Similarities and Differences in Structural Organization and Gating. Front Pharmacol. 2020;11:411. Published 2020 Apr 15. doi:10.3389/fphar.2020.00411

Cheng L, Kinard K, Rajamani R, Sanguinetti MC. Molecular mapping of the binding site for a blocker of hyperpolarization-activated, cyclic nucleotide-modulated pacemaker channels. J Pharmacol Exp Ther. 2007;322(3):931-939. doi:10.1124/jpet.107.121467

Fernández-Mariño AI, Harpole TJ, Oelstrom K, Delemotte L, Chanda B. Gating interaction maps reveal a noncanonical electromechanical coupling mode in the Shaker K+ channel. Nat Struct Mol Biol. 2018;25(4):320-326. doi:10.1038/s41594-018-0047-3

Flynn GE, Zagotta WN. Insights into the molecular mechanism for hyperpolarization-dependent activation of HCN channels. Proc Natl Acad Sci U S A. 2018;115(34):E8086-E8095. doi:10.1073/pnas.1805596115

Kang PW, Westerlund AM, Shi J, et al. Calmodulin acts as a state-dependent switch to control a cardiac potassium channel opening. Sci Adv. 2020;6(50):eabd6798. Published 2020 Dec 11. doi:10.1126/sciadv.abd6798

Klesse G, Rao S, Sansom MSP, Tucker SJ. CHAP: A Versatile Tool for the Structural and Functional Annotation of Ion Channel Pores. J Mol Biol. 2019;431(17):3353-3365. doi:10.1016/j.jmb.2019.06.003

Labro AJ, Raes AL, Bellens I, Ottschytsch N, Snyders DJ. Gating of shaker-type channels requires the flexibility of S6 caused by prolines. J Biol Chem. 2003;278(50):50724-50731. doi:10.1074/jbc.M306097200

Lee CH, MacKinnon R. Structures of the Human HCN1 Hyperpolarization-Activated Channel. Cell. 2017;168(1-2):111-120.e11. doi:10.1016/j.cell.2016.12.023

Macri V, Nazzari H, McDonald E, Accili EA. Alanine scanning of the S6 segment reveals a unique and cAMP-sensitive association between the pore and voltage-dependent opening in HCN channels. J Biol Chem. 2009;284(23):15659-15667. doi:10.1074/jbc.M809164200

Männikkö R, Elinder F, Larsson HP. Voltage-sensing mechanism is conserved among ion channels gated by opposite voltages. Nature. 2002;419(6909):837-841. doi:10.1038/nature01038

Ramentol R, Perez ME, Larsson HP. Gating mechanism of hyperpolarization-activated HCN pacemaker channels. Nat Commun. 2020;11(1):1419. Published 2020 Mar 17. doi:10.1038/s41467-020-15233-9

Rao S, Klesse G, Lynch CI, Tucker SJ, Sansom MSP. Molecular Simulations of Hydrophobic Gating of Pentameric Ligand Gated Ion Channels: Insights into Water and Ions. J Phys Chem B. 2021;125(4):981-994. doi:10.1021/acs.jpcb.0c09285

Ryu S, Yellen G. Charge movement in gating-locked HCN channels reveals weak coupling of voltage sensors and gate. J Gen Physiol. 2012;140(5):469-479. doi:10.1085/jgp.201210850

Saponaro A, Bauer D, Giese MH, et al. Gating movements and ion permeation in HCN4 pacemaker channels. Mol Cell. 2021;81(14):2929-2943.e6. doi:10.1016/j.molcel.2021.05.033

Wemhöner K, Silbernagel N, Marzian S, et al. A leucine zipper motif essential for gating of hyperpolarization-activated channels. J Biol Chem. 2012;287(48):40150-40160. doi:10.1074/jbc.M112.378513

# Appendix

## Script that interfaces with Cytoscape to generate and analyze RINs
<pre style='color:#d1d1d1;background:#000000;'><span style='color:#9999a9; '># modified based on:</span>
<span style='color:#9999a9; '># </span><span style='color:#6070ec; '>https://hal.archives-ouvertes.fr/hal-02389343/document</span>

<span style='color:#e66170; font-weight:bold; '>import</span> requests<span style='color:#d2cd86; '>,</span> time<span style='color:#d2cd86; '>,</span> string 
<span style='color:#e66170; font-weight:bold; '>import</span> urllib<span style='color:#d2cd86; '>,</span> glob<span style='color:#d2cd86; '>,</span> os<span style='color:#d2cd86; '>,</span> sys<span style='color:#d2cd86; '>,</span> json

<span style='color:#e66170; font-weight:bold; '>import</span> math 
<span style='color:#e66170; font-weight:bold; '>import</span> numpy <span style='color:#e66170; font-weight:bold; '>as</span> np 
<span style='color:#e66170; font-weight:bold; '>import</span> pandas <span style='color:#e66170; font-weight:bold; '>as</span> pd 
<span style='color:#e66170; font-weight:bold; '>import</span> matplotlib<span style='color:#d2cd86; '>.</span>pyplot <span style='color:#e66170; font-weight:bold; '>as</span> plt 

<span style='color:#9999a9; '># commands to structureviz/chimera require encoding ASCII symbols into URL </span>
<span style='color:#9999a9; '># this is done using %-straddled integers</span>
<span style='color:#9999a9; '># e.g. chimera > select :.A === select%20%3A., where %20 = '\s', %3a = ':'</span>
<span style='color:#9999a9; '># note that '+' can be used inplace of '%20'</span>
urlChimera <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/structureViz/send?command="</span> 
urlCreateRIN <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/structureViz/createRIN?"</span> 
RINparameters <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"includeHBonds=true&amp;ignoreWater=true&amp;distCutoff=4.5"</span> 
urlDelete <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/network/delete"</span> 

<span style='color:#e66170; font-weight:bold; '>def</span> OpenPDB<span style='color:#d2cd86; '>(</span>path<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>,</span> s<span style='color:#d2cd86; '>=</span>urlChimera<span style='color:#d2cd86; '>,</span> t<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>5</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    <span style='color:#9999a9; '># encode as URL </span>
    q <span style='color:#d2cd86; '>=</span> urllib<span style='color:#d2cd86; '>.</span>parse<span style='color:#d2cd86; '>.</span>quote<span style='color:#d2cd86; '>(</span>path<span style='color:#d2cd86; '>,</span> safe<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>''</span><span style='color:#d2cd86; '>)</span>
    s <span style='color:#d2cd86; '>=</span> s <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"open%20"</span> <span style='color:#00dddd; '>+</span> q
    requests<span style='color:#d2cd86; '>.</span>get<span style='color:#d2cd86; '>(</span>s<span style='color:#d2cd86; '>)</span>
    time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span>t<span style='color:#d2cd86; '>)</span> 
    
<span style='color:#e66170; font-weight:bold; '>def</span> DeleteHet<span style='color:#d2cd86; '>(</span>s<span style='color:#d2cd86; '>=</span>urlChimera<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    <span style='color:#9999a9; '># delete non-protein</span>
    requests<span style='color:#d2cd86; '>.</span>get<span style='color:#d2cd86; '>(</span>s <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"delete%20%7e.protein"</span><span style='color:#d2cd86; '>)</span>    
    time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>5</span><span style='color:#d2cd86; '>)</span> 
    
<span style='color:#e66170; font-weight:bold; '>def</span> SelectProtein<span style='color:#d2cd86; '>(</span>sel<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>,</span> s<span style='color:#d2cd86; '>=</span>urlChimera<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    
    <span style='color:#9999a9; '># clear selection</span>
    <span style='color:#e66170; font-weight:bold; '>if</span> sel <span style='color:#e66170; font-weight:bold; '>is</span> None<span style='color:#d2cd86; '>:</span>
        sel <span style='color:#d2cd86; '>=</span> urllib<span style='color:#d2cd86; '>.</span>parse<span style='color:#d2cd86; '>.</span>quote<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"~select"</span><span style='color:#d2cd86; '>)</span>
    <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
        sel <span style='color:#d2cd86; '>=</span> urllib<span style='color:#d2cd86; '>.</span>parse<span style='color:#d2cd86; '>.</span>quote<span style='color:#d2cd86; '>(</span>sel<span style='color:#d2cd86; '>)</span>
        
    requests<span style='color:#d2cd86; '>.</span>get<span style='color:#d2cd86; '>(</span>s <span style='color:#00dddd; '>+</span> sel<span style='color:#d2cd86; '>)</span>
    time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>5</span><span style='color:#d2cd86; '>)</span>
    
<span style='color:#e66170; font-weight:bold; '>def</span> DeleteAll<span style='color:#d2cd86; '>(</span>s<span style='color:#d2cd86; '>=</span>urlChimera<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    requests<span style='color:#d2cd86; '>.</span>get<span style='color:#d2cd86; '>(</span>s <span style='color:#00dddd; '>+</span> urllib<span style='color:#d2cd86; '>.</span>parse<span style='color:#d2cd86; '>.</span>quote<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"delete #0"</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
    time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>5</span><span style='color:#d2cd86; '>)</span>
    
<span style='color:#e66170; font-weight:bold; '>def</span> AlignAll<span style='color:#d2cd86; '>(</span>N<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>6</span><span style='color:#d2cd86; '>,</span> s<span style='color:#d2cd86; '>=</span>urlChimera<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    q <span style='color:#d2cd86; '>=</span> urllib<span style='color:#d2cd86; '>.</span>parse<span style='color:#d2cd86; '>.</span>quote<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"mm #0 #1-%d show true"</span> <span style='color:#00dddd; '>%</span> N<span style='color:#d2cd86; '>)</span>
    requests<span style='color:#d2cd86; '>.</span>get<span style='color:#d2cd86; '>(</span>s <span style='color:#00dddd; '>+</span> q<span style='color:#d2cd86; '>)</span>
    time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>5</span><span style='color:#d2cd86; '>)</span> 

<span style='color:#e66170; font-weight:bold; '>class</span> Cyto<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
    <span style='color:#e66170; font-weight:bold; '>def</span> __init__<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> construct<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>,</span> pdb_path<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>,</span> out_path<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        <span style='color:#9999a9; '>"""</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;`pdb_path` should contain format field in file name, e.g. /{0}_output.pdb</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;`out_path` should contain a format field in file name, e.g. /{0}_out.csv</span>
<span style='color:#9999a9; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"""</span>

        self<span style='color:#d2cd86; '>.</span>NetNames <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        self<span style='color:#d2cd86; '>.</span>PDBPaths <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        self<span style='color:#d2cd86; '>.</span>c <span style='color:#d2cd86; '>=</span> construct 
        
        self<span style='color:#d2cd86; '>.</span>methods_dict <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>dict</span><span style='color:#d2cd86; '>(</span>
            CCA<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'Closeness - CCA'</span><span style='color:#d2cd86; '>,</span>
            BCA<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>"Betweenness - BCA"</span><span style='color:#d2cd86; '>,</span>
            RCA<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>"Residue (ASPL change under removal of individual nodes) - RCA"</span><span style='color:#d2cd86; '>,</span>
        <span style='color:#d2cd86; '>)</span>
        
        self<span style='color:#d2cd86; '>.</span>table_out_path <span style='color:#d2cd86; '>=</span> out_path 
        self<span style='color:#d2cd86; '>.</span>pdb_path <span style='color:#d2cd86; '>=</span> pdb_path 
        self<span style='color:#d2cd86; '>.</span>table_paths <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        
    <span style='color:#e66170; font-weight:bold; '>def</span> NetworkNames<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> pdb_files<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>list</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        self<span style='color:#d2cd86; '>.</span>NetNames <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        self<span style='color:#d2cd86; '>.</span>PDBPaths <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        
        <span style='color:#e66170; font-weight:bold; '>for</span> f <span style='color:#e66170; font-weight:bold; '>in</span> pdb_files<span style='color:#d2cd86; '>:</span>
            <span style='color:#9999a9; '># reeplace with Chimera compatible slashes</span>
            self<span style='color:#d2cd86; '>.</span>PDBPaths<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span>f<span style='color:#d2cd86; '>.</span>replace<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"/"</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>"</span><span style='color:#008080; '>\\</span><span style='color:#00c4c4; '>"</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#9999a9; '># get frame number</span>
            fname <span style='color:#d2cd86; '>=</span> os<span style='color:#d2cd86; '>.</span>path<span style='color:#d2cd86; '>.</span>basename<span style='color:#d2cd86; '>(</span>f<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#00dddd; '>-</span><span style='color:#00a800; '>4</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>split<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"_"</span><span style='color:#d2cd86; '>)</span>
            frame <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>int</span><span style='color:#d2cd86; '>(</span> <span style='color:#d2cd86; '>[</span>x <span style='color:#e66170; font-weight:bold; '>for</span> x <span style='color:#e66170; font-weight:bold; '>in</span> fname <span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#00c4c4; '>'Frame'</span> <span style='color:#e66170; font-weight:bold; '>in</span> x<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>5</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>]</span> <span style='color:#d2cd86; '>)</span>
            self<span style='color:#d2cd86; '>.</span>NetNames<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span> <span style='color:#00c4c4; '>"%s-%d"</span> <span style='color:#00dddd; '>%</span> <span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>c<span style='color:#d2cd86; '>,</span> frame<span style='color:#d2cd86; '>)</span> <span style='color:#d2cd86; '>)</span>

    <span style='color:#e66170; font-weight:bold; '>def</span> GetFiles<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        <span style='color:#9999a9; '># read all pdb files </span>
        files <span style='color:#d2cd86; '>=</span> glob<span style='color:#d2cd86; '>.</span>glob<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>pdb_path<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>c<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
        
        <span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>files<span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>&lt;</span> <span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>:</span>
            <span style='color:#e66170; font-weight:bold; '>raise</span> Exception<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"No files found for &lt; %s >"</span> <span style='color:#00dddd; '>%</span> self<span style='color:#d2cd86; '>.</span>c<span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
            self<span style='color:#d2cd86; '>.</span>NetworkNames<span style='color:#d2cd86; '>(</span>files<span style='color:#d2cd86; '>)</span>
            
        <span style='color:#e66170; font-weight:bold; '>return</span> self<span style='color:#d2cd86; '>.</span>PDBPaths

    <span style='color:#e66170; font-weight:bold; '>def</span> OpenPDBs_Chimera<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> port<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>int</span><span style='color:#d2cd86; '>,</span> t<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>10</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        self<span style='color:#d2cd86; '>.</span>GetFiles<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        
        url <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:%d/run?command="</span> <span style='color:#00dddd; '>%</span> port 
        msg0 <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"Opening... &lt; {0} >"</span>
        <span style='color:#e66170; font-weight:bold; '>for</span> f <span style='color:#e66170; font-weight:bold; '>in</span> self<span style='color:#d2cd86; '>.</span>PDBPaths<span style='color:#d2cd86; '>:</span>
            <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span>msg0<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>f<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
            OpenPDB<span style='color:#d2cd86; '>(</span>f<span style='color:#d2cd86; '>,</span> s<span style='color:#d2cd86; '>=</span>url<span style='color:#d2cd86; '>,</span> t<span style='color:#d2cd86; '>=</span>t<span style='color:#d2cd86; '>)</span>
        
    <span style='color:#e66170; font-weight:bold; '>def</span> do_RIN<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> delete_het<span style='color:#d2cd86; '>=</span>False<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        
        self<span style='color:#d2cd86; '>.</span>GetFiles<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        
        <span style='color:#9999a9; '># naming of RINs</span>
        CreateRIN <span style='color:#d2cd86; '>=</span> urlCreateRIN <span style='color:#00dddd; '>+</span> RINparameters <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"&amp;networkName={0}"</span>
        
        <span style='color:#9999a9; '># loop over models and create RINs for each</span>
        <span style='color:#e66170; font-weight:bold; '>for</span> i <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>range</span><span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>PDBPaths<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
            OpenPDB<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>PDBPaths<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#9999a9; '># delete non protein </span>
            <span style='color:#e66170; font-weight:bold; '>if</span> delete_het<span style='color:#d2cd86; '>:</span>
                DeleteHet<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>      
            
            <span style='color:#9999a9; '># select i-th model</span>
            SelectProtein<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"select #0"</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#9999a9; '># construct RIN </span>
            <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Creating %d-th RIN... %s"</span> <span style='color:#00dddd; '>%</span> <span style='color:#d2cd86; '>(</span>i<span style='color:#d2cd86; '>,</span> self<span style='color:#d2cd86; '>.</span>NetNames<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
            requests<span style='color:#d2cd86; '>.</span>get<span style='color:#d2cd86; '>(</span>CreateRIN<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>NetNames<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
            
            time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>30</span><span style='color:#d2cd86; '>)</span>
            <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Deleting structure and continuing..."</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#9999a9; '># deselect all </span>
            SelectProtein<span style='color:#d2cd86; '>(</span>None<span style='color:#d2cd86; '>)</span> 
            
            <span style='color:#9999a9; '># delete all; open again later to set layout</span>
            DeleteAll<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>def</span> GetNetworkSUIDs<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>    
        
        urlList <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/network/list"</span> 
        
        <span style='color:#9999a9; '>#gets the list of networks SUIDs </span>
        networksList <span style='color:#d2cd86; '>=</span> requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>urlList<span style='color:#d2cd86; '>)</span> 
        networksList <span style='color:#d2cd86; '>=</span> networksList<span style='color:#d2cd86; '>.</span>json<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span> 
        networksList <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>(</span>networksList<span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"data"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"networks"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span> 
        
        <span style='color:#e66170; font-weight:bold; '>return</span> networksList
        
    <span style='color:#e66170; font-weight:bold; '>def</span> do_Centrality<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> method<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'BCA'</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        
        <span style='color:#e66170; font-weight:bold; '>if</span> method <span style='color:#e66170; font-weight:bold; '>in</span> self<span style='color:#d2cd86; '>.</span>methods_dict<span style='color:#d2cd86; '>.</span>keys<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
            typeOfCentrality <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>methods_dict<span style='color:#d2cd86; '>[</span>method<span style='color:#d2cd86; '>]</span>
        <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
            <span style='color:#e66170; font-weight:bold; '>raise</span> Exception<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"%s centrality not supported."</span><span style='color:#d2cd86; '>)</span>
        
        <span style='color:#9999a9; '>#parameters </span>
        urlSetNetwork <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/network/set%20current"</span> 
        urlCentrality <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/rinspector/centrality"</span> 
        
        <span style='color:#9999a9; '>#gets the list of networks SUIDs </span>
        networksList <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>GetNetworkSUIDs<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        
        <span style='color:#9999a9; '>#calculates centralities for each network </span>
        <span style='color:#e66170; font-weight:bold; '>for</span> j<span style='color:#d2cd86; '>,</span> i <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>enumerate</span><span style='color:#d2cd86; '>(</span>networksList<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span> 
            <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Computing centrality for %s (%d of %d)..."</span> <span style='color:#00dddd; '>%</span> <span style='color:#d2cd86; '>(</span>i<span style='color:#d2cd86; '>,</span> j<span style='color:#d2cd86; '>,</span> <span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>networksList<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#9999a9; '>#sets the network </span>
            requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>urlSetNetwork<span style='color:#d2cd86; '>,</span> json<span style='color:#d2cd86; '>=</span><span style='color:#b060b0; '>{</span><span style='color:#00c4c4; '>"network"</span><span style='color:#d2cd86; '>:</span><span style='color:#00c4c4; '>"SUID:"</span><span style='color:#00dddd; '>+</span><span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>(</span>i<span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>}</span><span style='color:#d2cd86; '>)</span> 
            
            <span style='color:#9999a9; '>#calculates centralities </span>
            requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>urlCentrality<span style='color:#d2cd86; '>,</span> json<span style='color:#d2cd86; '>=</span><span style='color:#b060b0; '>{</span><span style='color:#00c4c4; '>"analysisType"</span><span style='color:#d2cd86; '>:</span> typeOfCentrality<span style='color:#b060b0; '>}</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>def</span> ExportTables<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> which<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'node'</span><span style='color:#d2cd86; '>,</span> overwrite<span style='color:#d2cd86; '>=</span>False<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        <span style='color:#9999a9; '># get list of table SUIDs </span>
        u <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/table/list"</span>
        
        <span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>NetNames<span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>&lt;</span> <span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>:</span>
            self<span style='color:#d2cd86; '>.</span>NetworkNames<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        
        kw <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>dict</span><span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>type</span><span style='color:#d2cd86; '>=</span>which<span style='color:#d2cd86; '>)</span>
        
        <span style='color:#e66170; font-weight:bold; '>if</span> which <span style='color:#00dddd; '>==</span> <span style='color:#00c4c4; '>'all'</span><span style='color:#d2cd86; '>:</span>
            kw<span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>'type'</span><span style='color:#d2cd86; '>]</span> <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>'node'</span>
            tablesList <span style='color:#d2cd86; '>=</span> requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>,</span> json<span style='color:#d2cd86; '>=</span>kw<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>json<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"data"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"tables"</span><span style='color:#d2cd86; '>]</span>
            kw<span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>'type'</span><span style='color:#d2cd86; '>]</span> <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>'edge'</span>
            tablesList<span style='color:#d2cd86; '>.</span>extend<span style='color:#d2cd86; '>(</span>requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>,</span> json<span style='color:#d2cd86; '>=</span>kw<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>json<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"data"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"tables"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
            
            TableNames <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span>n <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>" default node"</span> <span style='color:#e66170; font-weight:bold; '>for</span> n <span style='color:#e66170; font-weight:bold; '>in</span> self<span style='color:#d2cd86; '>.</span>NetNames<span style='color:#d2cd86; '>]</span>
            TableNames<span style='color:#d2cd86; '>.</span>extend<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>[</span>n <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>" default edge"</span> <span style='color:#e66170; font-weight:bold; '>for</span> n <span style='color:#e66170; font-weight:bold; '>in</span> self<span style='color:#d2cd86; '>.</span>NetNames<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
            tablesList <span style='color:#d2cd86; '>=</span> requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>,</span> json<span style='color:#d2cd86; '>=</span>kw<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>json<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"data"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"tables"</span><span style='color:#d2cd86; '>]</span>
            TableNames <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"%s default %s"</span> <span style='color:#00dddd; '>%</span> <span style='color:#d2cd86; '>(</span>n<span style='color:#d2cd86; '>,</span> which<span style='color:#d2cd86; '>)</span> <span style='color:#e66170; font-weight:bold; '>for</span> n <span style='color:#e66170; font-weight:bold; '>in</span> self<span style='color:#d2cd86; '>.</span>NetNames<span style='color:#d2cd86; '>]</span>
        
        <span style='color:#9999a9; '># empty list </span>
        self<span style='color:#d2cd86; '>.</span>table_paths <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        
        u <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/table/export"</span>
        N <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>TableNames<span style='color:#d2cd86; '>)</span>
        msg <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"Successfully saved table &lt; {0} > to: </span><span style='color:#008080; '>\n</span><span style='color:#00c4c4; '> {1}"</span>
        
        urlSetNetwork <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"http://localhost:1234/v1/commands/network/set%20current"</span>
        networksList <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#e66170; font-weight:bold; '>str</span><span style='color:#d2cd86; '>(</span>x<span style='color:#d2cd86; '>)</span> <span style='color:#e66170; font-weight:bold; '>for</span> x <span style='color:#e66170; font-weight:bold; '>in</span> self<span style='color:#d2cd86; '>.</span>GetNetworkSUIDs<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>]</span>
        N_networks <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>networksList<span style='color:#d2cd86; '>)</span>
        
        <span style='color:#e66170; font-weight:bold; '>for</span> i<span style='color:#d2cd86; '>,</span> T <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>enumerate</span><span style='color:#d2cd86; '>(</span>TableNames<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
            <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"%d-th table of %d"</span> <span style='color:#00dddd; '>%</span> <span style='color:#d2cd86; '>(</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span> N<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
                        
            kw <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>dict</span><span style='color:#d2cd86; '>(</span>
                options <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"CSV"</span><span style='color:#d2cd86; '>,</span> table <span style='color:#d2cd86; '>=</span> T<span style='color:#d2cd86; '>,</span>
                outputFile <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>table_out_path<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>T<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>,</span>
            <span style='color:#d2cd86; '>)</span>
            <span style='color:#9999a9; '># print(kw)</span>
            
            <span style='color:#e66170; font-weight:bold; '>if</span> os<span style='color:#d2cd86; '>.</span>path<span style='color:#d2cd86; '>.</span>isfile<span style='color:#d2cd86; '>(</span>kw<span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"outputFile"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span> <span style='color:#e66170; font-weight:bold; '>and</span> <span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>not</span> overwrite<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span> 
                self<span style='color:#d2cd86; '>.</span>table_paths<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span> kw<span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"outputFile"</span><span style='color:#d2cd86; '>]</span> <span style='color:#d2cd86; '>)</span>
                <span style='color:#e66170; font-weight:bold; '>continue</span> 
            
            <span style='color:#9999a9; '>#sets the network </span>
            <span style='color:#e66170; font-weight:bold; '>if</span> i <span style='color:#00dddd; '>>=</span> N_networks<span style='color:#d2cd86; '>:</span>
                kw <span style='color:#d2cd86; '>=</span> <span style='color:#b060b0; '>{</span><span style='color:#00c4c4; '>"network"</span><span style='color:#d2cd86; '>:</span><span style='color:#00c4c4; '>"SUID:"</span> <span style='color:#00dddd; '>+</span> networksList<span style='color:#d2cd86; '>[</span>i <span style='color:#00dddd; '>-</span> N_networks<span style='color:#d2cd86; '>]</span><span style='color:#b060b0; '>}</span>
            <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
                kw <span style='color:#d2cd86; '>=</span> <span style='color:#b060b0; '>{</span><span style='color:#00c4c4; '>"network"</span><span style='color:#d2cd86; '>:</span><span style='color:#00c4c4; '>"SUID:"</span> <span style='color:#00dddd; '>+</span> networksList<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span><span style='color:#b060b0; '>}</span>

            r <span style='color:#d2cd86; '>=</span> requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>urlSetNetwork<span style='color:#d2cd86; '>,</span> json<span style='color:#d2cd86; '>=</span>kw<span style='color:#d2cd86; '>)</span> 
            time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>5</span><span style='color:#d2cd86; '>)</span>
            
            r <span style='color:#d2cd86; '>=</span> requests<span style='color:#d2cd86; '>.</span>post<span style='color:#d2cd86; '>(</span>u<span style='color:#d2cd86; '>,</span> json<span style='color:#d2cd86; '>=</span>kw<span style='color:#d2cd86; '>)</span>
            time<span style='color:#d2cd86; '>.</span>sleep<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>20</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#e66170; font-weight:bold; '>if</span> r<span style='color:#d2cd86; '>.</span>status_code <span style='color:#00dddd; '>==</span> <span style='color:#00a800; '>404</span><span style='color:#d2cd86; '>:</span>
                <span style='color:#e66170; font-weight:bold; '>try</span><span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span>r<span style='color:#d2cd86; '>.</span>json<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span> 
                <span style='color:#e66170; font-weight:bold; '>except</span><span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span>r<span style='color:#d2cd86; '>.</span>text<span style='color:#d2cd86; '>)</span>
                <span style='color:#9999a9; '># continue </span>
            <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>       
                self<span style='color:#d2cd86; '>.</span>table_paths<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span> kw<span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"outputFile"</span><span style='color:#d2cd86; '>]</span> <span style='color:#d2cd86; '>)</span>
                <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span>msg<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>T<span style='color:#d2cd86; '>,</span> kw<span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"outputFile"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>

        <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Saved files: </span><span style='color:#008080; '>\n</span><span style='color:#00c4c4; '>"</span><span style='color:#d2cd86; '>,</span> self<span style='color:#d2cd86; '>.</span>table_paths<span style='color:#d2cd86; '>)</span>
    
    <span style='color:#e66170; font-weight:bold; '>def</span> read_data<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> cols<span style='color:#d2cd86; '>=</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"RINalyzerResidue"</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>"Z-score_BCA"</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        files <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>table_paths 
        
        <span style='color:#9999a9; '># check that files exist </span>
        <span style='color:#e66170; font-weight:bold; '>for</span> f <span style='color:#e66170; font-weight:bold; '>in</span> files<span style='color:#d2cd86; '>:</span>
            <span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#e66170; font-weight:bold; '>not</span> os<span style='color:#d2cd86; '>.</span>path<span style='color:#d2cd86; '>.</span>isfile<span style='color:#d2cd86; '>(</span>f<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
                <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Table not saved for: </span><span style='color:#008080; '>\n</span><span style='color:#00c4c4; '>"</span><span style='color:#d2cd86; '>,</span> f<span style='color:#d2cd86; '>)</span>
                        
        df_lis <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        <span style='color:#e66170; font-weight:bold; '>for</span> f <span style='color:#e66170; font-weight:bold; '>in</span> files<span style='color:#d2cd86; '>:</span>
            df <span style='color:#d2cd86; '>=</span> pd<span style='color:#d2cd86; '>.</span>read_csv<span style='color:#d2cd86; '>(</span>f<span style='color:#d2cd86; '>,</span> index_col<span style='color:#d2cd86; '>=</span>None<span style='color:#d2cd86; '>,</span> header<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>)</span>
            df <span style='color:#d2cd86; '>=</span> df<span style='color:#d2cd86; '>.</span>loc<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>,</span> cols<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>set_index<span style='color:#d2cd86; '>(</span>cols<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>sort_index<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
            df_lis<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span>df<span style='color:#d2cd86; '>)</span>
            
        df_merge <span style='color:#d2cd86; '>=</span> pd<span style='color:#d2cd86; '>.</span>concat<span style='color:#d2cd86; '>(</span>df_lis<span style='color:#d2cd86; '>,</span> axis<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>)</span>    
        <span style='color:#e66170; font-weight:bold; '>return</span> df_merge 

    <span style='color:#e66170; font-weight:bold; '>def</span> analyze_bca<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> start<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>136</span><span style='color:#d2cd86; '>,</span> save<span style='color:#d2cd86; '>=</span>True<span style='color:#d2cd86; '>,</span> show<span style='color:#d2cd86; '>=</span>True<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        df <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>read_data<span style='color:#d2cd86; '>(</span>cols<span style='color:#d2cd86; '>=</span><span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>'RINalyzerResidue'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'Z-score_BCA'</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
        df_bca <span style='color:#d2cd86; '>=</span> pd<span style='color:#d2cd86; '>.</span>DataFrame<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>[</span>df<span style='color:#d2cd86; '>.</span>mean<span style='color:#d2cd86; '>(</span>axis<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>,</span> df<span style='color:#d2cd86; '>.</span>sem<span style='color:#d2cd86; '>(</span>axis<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>T
        
        ResIndex <span style='color:#d2cd86; '>=</span> np<span style='color:#d2cd86; '>.</span>unique<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>[</span><span style='color:#e66170; font-weight:bold; '>int</span><span style='color:#d2cd86; '>(</span>s<span style='color:#d2cd86; '>.</span>split<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>":"</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span> <span style='color:#e66170; font-weight:bold; '>for</span> s <span style='color:#e66170; font-weight:bold; '>in</span> df_bca<span style='color:#d2cd86; '>.</span>index<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
        inds <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>list</span><span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>range</span><span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>5</span><span style='color:#00dddd; '>*</span>ResIndex<span style='color:#d2cd86; '>.</span>shape<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> ResIndex<span style='color:#d2cd86; '>.</span>shape<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
        
        <span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#e66170; font-weight:bold; '>min</span><span style='color:#d2cd86; '>(</span>ResIndex<span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>!=</span> start<span style='color:#d2cd86; '>:</span>
            ResIndex <span style='color:#00dddd; '>+</span><span style='color:#d2cd86; '>=</span> start 
        
        data <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span> 
        
        cmap <span style='color:#d2cd86; '>=</span> plt<span style='color:#d2cd86; '>.</span>cm<span style='color:#d2cd86; '>.</span>get_cmap<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"gist_rainbow"</span><span style='color:#d2cd86; '>)</span>
        chains <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>'A'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'B'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'C'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'D'</span><span style='color:#d2cd86; '>]</span>
        <span style='color:#e66170; font-weight:bold; '>for</span> i<span style='color:#d2cd86; '>,</span> x <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>enumerate</span><span style='color:#d2cd86; '>(</span>chains<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
            clr <span style='color:#d2cd86; '>=</span> cmap<span style='color:#d2cd86; '>(</span>i<span style='color:#00dddd; '>/</span><span style='color:#00a800; '>4</span><span style='color:#d2cd86; '>)</span>
            a<span style='color:#d2cd86; '>,</span> b <span style='color:#d2cd86; '>=</span> inds<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>:</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>]</span>
            
            y <span style='color:#d2cd86; '>=</span> df_bca<span style='color:#d2cd86; '>.</span>iloc<span style='color:#d2cd86; '>[</span>a<span style='color:#d2cd86; '>:</span>b<span style='color:#d2cd86; '>,</span> <span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>]</span>
            
            plt<span style='color:#d2cd86; '>.</span>fill_between<span style='color:#d2cd86; '>(</span>
                ResIndex<span style='color:#d2cd86; '>,</span> y<span style='color:#d2cd86; '>.</span>iloc<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>-</span> y<span style='color:#d2cd86; '>.</span>iloc<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> 
                y<span style='color:#d2cd86; '>.</span>iloc<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>+</span> y<span style='color:#d2cd86; '>.</span>iloc<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> lw<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span> label<span style='color:#d2cd86; '>=</span>x<span style='color:#d2cd86; '>,</span> 
                color<span style='color:#d2cd86; '>=</span>clr<span style='color:#d2cd86; '>,</span> alpha<span style='color:#d2cd86; '>=</span><span style='color:#009f00; '>0.3</span><span style='color:#d2cd86; '>,</span> zorder<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span>
            <span style='color:#d2cd86; '>)</span>
            
            data<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span>y<span style='color:#d2cd86; '>.</span>reset_index<span style='color:#d2cd86; '>(</span>drop<span style='color:#d2cd86; '>=</span>True<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
        
        outp <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>table_out_path<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>.</span>c <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"_AvgBCA"</span><span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>if</span> save<span style='color:#d2cd86; '>:</span>
            df_out <span style='color:#d2cd86; '>=</span> pd<span style='color:#d2cd86; '>.</span>concat<span style='color:#d2cd86; '>(</span>data<span style='color:#d2cd86; '>,</span> axis<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>)</span>
            
            cols <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>list</span><span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>range</span><span style='color:#d2cd86; '>(</span>df_out<span style='color:#d2cd86; '>.</span>shape<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
            cols<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>:</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>]</span> <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span>chain <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"_Mean"</span> <span style='color:#e66170; font-weight:bold; '>for</span> chain <span style='color:#e66170; font-weight:bold; '>in</span> chains<span style='color:#d2cd86; '>]</span>
            cols<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>:</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>]</span> <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span>chain <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"_SEM"</span> <span style='color:#e66170; font-weight:bold; '>for</span> chain <span style='color:#e66170; font-weight:bold; '>in</span> chains<span style='color:#d2cd86; '>]</span>
            df_out<span style='color:#d2cd86; '>.</span>columns <span style='color:#d2cd86; '>=</span> cols 
            
            df_out<span style='color:#d2cd86; '>.</span>index <span style='color:#d2cd86; '>=</span> df_bca<span style='color:#d2cd86; '>.</span>index<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span>df_out<span style='color:#d2cd86; '>.</span>shape<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>]</span>
            df_out<span style='color:#d2cd86; '>.</span>to_parquet<span style='color:#d2cd86; '>(</span>outp<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#00dddd; '>-</span><span style='color:#00a800; '>4</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>".parquet"</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#e66170; font-weight:bold; '>print</span><span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Saved averaged BCA to &lt; %s >"</span> <span style='color:#00dddd; '>%</span> outp<span style='color:#d2cd86; '>)</span>
        
        <span style='color:#e66170; font-weight:bold; '>if</span> show<span style='color:#d2cd86; '>:</span>
            
            plt<span style='color:#d2cd86; '>.</span>ylim<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>[</span><span style='color:#00dddd; '>-</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>6</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
            plt<span style='color:#d2cd86; '>.</span>xlabel<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Residue"</span><span style='color:#d2cd86; '>)</span>
            plt<span style='color:#d2cd86; '>.</span>ylabel<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Betweenness Centrality"</span><span style='color:#d2cd86; '>)</span>
            
            plt<span style='color:#d2cd86; '>.</span>legend<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
            plt<span style='color:#d2cd86; '>.</span>tight_layout<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
            plt<span style='color:#d2cd86; '>.</span>savefig<span style='color:#d2cd86; '>(</span>outp<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#00dddd; '>-</span><span style='color:#00a800; '>4</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>".png"</span><span style='color:#d2cd86; '>)</span>
            
            plt<span style='color:#d2cd86; '>.</span>show<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        
        plt<span style='color:#d2cd86; '>.</span>close<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        
        <span style='color:#e66170; font-weight:bold; '>return</span> df_bca 
    
    <span style='color:#e66170; font-weight:bold; '>def</span> FullCentrality<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        self<span style='color:#d2cd86; '>.</span>do_RIN<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        self<span style='color:#d2cd86; '>.</span>do_Centrality<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        self<span style='color:#d2cd86; '>.</span>ExportTables<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        self<span style='color:#d2cd86; '>.</span>analyze_bca<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        
    <span style='color:#e66170; font-weight:bold; '>def</span> multi_bca<span style='color:#d2cd86; '>(</span>self<span style='color:#d2cd86; '>,</span> models<span style='color:#d2cd86; '>:</span> <span style='color:#e66170; font-weight:bold; '>list</span><span style='color:#d2cd86; '>,</span> start<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>136</span><span style='color:#d2cd86; '>,</span> cmap<span style='color:#d2cd86; '>=</span>plt<span style='color:#d2cd86; '>.</span>cm<span style='color:#d2cd86; '>.</span>get_cmap<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>'tab10'</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
        
        n_models <span style='color:#d2cd86; '>=</span>  <span style='color:#e66170; font-weight:bold; '>len</span><span style='color:#d2cd86; '>(</span>models<span style='color:#d2cd86; '>)</span>        
        _<span style='color:#d2cd86; '>,</span> ax <span style='color:#d2cd86; '>=</span> plt<span style='color:#d2cd86; '>.</span>subplots<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>,</span> figsize<span style='color:#d2cd86; '>=</span><span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>10</span><span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>6</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>)</span>
        <span style='color:#9999a9; '># ax.set_xlabel("Residue", fontsize=14)</span>
        <span style='color:#9999a9; '># ax.set_ylabel("Betweenness Centrality", fontsize=14)</span>
                
        df_list <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>]</span>
        
        <span style='color:#e66170; font-weight:bold; '>for</span> i<span style='color:#d2cd86; '>,</span> m <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>enumerate</span><span style='color:#d2cd86; '>(</span>models<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
            p <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>table_out_path<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>m <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>"_AvgBCA"</span><span style='color:#d2cd86; '>)</span>
            df <span style='color:#d2cd86; '>=</span> pd<span style='color:#d2cd86; '>.</span>read_parquet<span style='color:#d2cd86; '>(</span> p<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#00dddd; '>-</span><span style='color:#00a800; '>4</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>".parquet"</span> <span style='color:#d2cd86; '>)</span>
            df <span style='color:#d2cd86; '>=</span> df<span style='color:#d2cd86; '>.</span>iloc<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>,</span> <span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>:</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>mean<span style='color:#d2cd86; '>(</span>axis<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>)</span>
            
            ResIndex <span style='color:#d2cd86; '>=</span> np<span style='color:#d2cd86; '>.</span>unique<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>[</span><span style='color:#e66170; font-weight:bold; '>int</span><span style='color:#d2cd86; '>(</span>s<span style='color:#d2cd86; '>.</span>split<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>":"</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span> <span style='color:#e66170; font-weight:bold; '>for</span> s <span style='color:#e66170; font-weight:bold; '>in</span> df<span style='color:#d2cd86; '>.</span>index<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#e66170; font-weight:bold; '>min</span><span style='color:#d2cd86; '>(</span>ResIndex<span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>!=</span> start<span style='color:#d2cd86; '>:</span>
                ResIndex <span style='color:#00dddd; '>+</span><span style='color:#d2cd86; '>=</span> start 
            
            df<span style='color:#d2cd86; '>.</span>index <span style='color:#d2cd86; '>=</span> ResIndex     
            df_list<span style='color:#d2cd86; '>.</span>append<span style='color:#d2cd86; '>(</span>df<span style='color:#d2cd86; '>)</span>

        lab <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"{0} - {1}"</span>
        kw <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>dict</span><span style='color:#d2cd86; '>(</span>lw<span style='color:#d2cd86; '>=</span><span style='color:#009f00; '>1.5</span><span style='color:#d2cd86; '>,</span> alpha<span style='color:#d2cd86; '>=</span><span style='color:#009f00; '>0.8</span><span style='color:#d2cd86; '>,</span> label<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>""</span><span style='color:#d2cd86; '>,</span> zorder<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>)</span>
        kw2 <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>dict</span><span style='color:#d2cd86; '>(</span>marker<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'o'</span><span style='color:#d2cd86; '>,</span> ms<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>6</span><span style='color:#d2cd86; '>,</span> mec<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'k'</span><span style='color:#d2cd86; '>,</span> mew<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span> ls<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'none'</span><span style='color:#d2cd86; '>,</span> zorder<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>3</span><span style='color:#d2cd86; '>,</span> c<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'r'</span><span style='color:#d2cd86; '>,</span> label<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>""</span><span style='color:#d2cd86; '>)</span>
        <span style='color:#e66170; font-weight:bold; '>for</span> i <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>range</span><span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>,</span> n_models<span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span> 
            j <span style='color:#d2cd86; '>=</span> <span style='color:#e66170; font-weight:bold; '>int</span><span style='color:#d2cd86; '>(</span>i<span style='color:#00dddd; '>/</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>)</span>
            
            <span style='color:#9999a9; '># [0,0] = wt x fa_5u6o, [1,1] = wt x fa_6uqg</span>
            ax<span style='color:#d2cd86; '>[</span>j<span style='color:#d2cd86; '>,</span>j<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>set_title<span style='color:#d2cd86; '>(</span> lab<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>models<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> models<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>,</span> fontsize<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>16</span> <span style='color:#d2cd86; '>)</span>
            y <span style='color:#d2cd86; '>=</span> df_list<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>-</span> df_list<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span>
            ax<span style='color:#d2cd86; '>[</span>j<span style='color:#d2cd86; '>,</span> j<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>plot<span style='color:#d2cd86; '>(</span>y<span style='color:#d2cd86; '>,</span> <span style='color:#00dddd; '>**</span>kw<span style='color:#d2cd86; '>)</span>
            
            y <span style='color:#d2cd86; '>=</span> y<span style='color:#d2cd86; '>[</span>y<span style='color:#d2cd86; '>.</span><span style='color:#e66170; font-weight:bold; '>abs</span><span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>>=</span> <span style='color:#009f00; '>1.5</span><span style='color:#d2cd86; '>]</span>
            ax<span style='color:#d2cd86; '>[</span>j<span style='color:#d2cd86; '>,</span> j<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>plot<span style='color:#d2cd86; '>(</span>y<span style='color:#d2cd86; '>,</span> <span style='color:#00dddd; '>**</span>kw2<span style='color:#d2cd86; '>)</span>

            <span style='color:#9999a9; '># [0,1] = wt_5u6o x wt_6uqg, [1,0] = fa_6uqg x fa_5u6o</span>
            <span style='color:#e66170; font-weight:bold; '>if</span> i <span style='color:#00dddd; '>></span> <span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>:</span>
                ax<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>set_title<span style='color:#d2cd86; '>(</span> lab<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>models<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> models<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>-</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>,</span> fontsize<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>16</span> <span style='color:#d2cd86; '>)</span>
                y <span style='color:#d2cd86; '>=</span> df_list<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>-</span> df_list<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>-</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span>
                ax<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>plot<span style='color:#d2cd86; '>(</span>y<span style='color:#d2cd86; '>,</span> <span style='color:#00dddd; '>**</span>kw<span style='color:#d2cd86; '>)</span>
                
                y <span style='color:#d2cd86; '>=</span> y<span style='color:#d2cd86; '>[</span>y<span style='color:#d2cd86; '>.</span><span style='color:#e66170; font-weight:bold; '>abs</span><span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>>=</span> <span style='color:#009f00; '>1.5</span><span style='color:#d2cd86; '>]</span>
                ax<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>plot<span style='color:#d2cd86; '>(</span>y<span style='color:#d2cd86; '>,</span> <span style='color:#00dddd; '>**</span>kw2<span style='color:#d2cd86; '>)</span>
                
            <span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#d2cd86; '>:</span>
                ax<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>set_title<span style='color:#d2cd86; '>(</span> lab<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>models<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>,</span> models<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>,</span> fontsize<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>16</span> <span style='color:#d2cd86; '>)</span>
                y <span style='color:#d2cd86; '>=</span> df_list<span style='color:#d2cd86; '>[</span>i<span style='color:#00dddd; '>+</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>-</span> df_list<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>]</span>
                ax<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>plot<span style='color:#d2cd86; '>(</span>y<span style='color:#d2cd86; '>,</span> <span style='color:#00dddd; '>**</span>kw<span style='color:#d2cd86; '>)</span>
                
                y <span style='color:#d2cd86; '>=</span> y<span style='color:#d2cd86; '>[</span>y<span style='color:#d2cd86; '>.</span><span style='color:#e66170; font-weight:bold; '>abs</span><span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span> <span style='color:#00dddd; '>>=</span> <span style='color:#009f00; '>1.5</span><span style='color:#d2cd86; '>]</span>
                ax<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>,</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>plot<span style='color:#d2cd86; '>(</span>y<span style='color:#d2cd86; '>,</span> <span style='color:#00dddd; '>**</span>kw2<span style='color:#d2cd86; '>)</span>
            
        <span style='color:#e66170; font-weight:bold; '>for</span> i <span style='color:#e66170; font-weight:bold; '>in</span> <span style='color:#e66170; font-weight:bold; '>range</span><span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>2</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>:</span>
            ax<span style='color:#d2cd86; '>[</span>i<span style='color:#d2cd86; '>,</span> <span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>set_ylabel<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>r"$\Delta Z_{BC}$"</span><span style='color:#d2cd86; '>,</span> rotation<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>0</span><span style='color:#d2cd86; '>,</span> 
                                labelpad<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>16</span><span style='color:#d2cd86; '>,</span> va<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'center'</span><span style='color:#d2cd86; '>,</span> fontsize<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>16</span><span style='color:#d2cd86; '>)</span>
            ax<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>1</span><span style='color:#d2cd86; '>,</span> i<span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>.</span>set_xlabel<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"Residue"</span><span style='color:#d2cd86; '>,</span> fontsize<span style='color:#d2cd86; '>=</span><span style='color:#00a800; '>16</span><span style='color:#d2cd86; '>)</span>
        
        plt<span style='color:#d2cd86; '>.</span>tight_layout<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
        f <span style='color:#d2cd86; '>=</span> self<span style='color:#d2cd86; '>.</span>table_out_path<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span><span style='color:#00c4c4; '>"DeltaAvgBCA"</span><span style='color:#d2cd86; '>)</span>
        plt<span style='color:#d2cd86; '>.</span>savefig<span style='color:#d2cd86; '>(</span>f<span style='color:#d2cd86; '>[</span><span style='color:#d2cd86; '>:</span><span style='color:#00dddd; '>-</span><span style='color:#00a800; '>4</span><span style='color:#d2cd86; '>]</span> <span style='color:#00dddd; '>+</span> <span style='color:#00c4c4; '>".png"</span><span style='color:#d2cd86; '>)</span>
        plt<span style='color:#d2cd86; '>.</span>show<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>

models <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>"wt_5u6o"</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>"F431A_5u6o"</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>"wt_6uqg"</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>"F431A_6uqg"</span><span style='color:#d2cd86; '>]</span>
outp <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"path/to/save/centrality/data/{0}.csv"</span>
pdb <span style='color:#d2cd86; '>=</span> <span style='color:#00c4c4; '>"path/to/save/pdb/{0}.pdb"</span>

NetNames <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span><span style='color:#00c4c4; '>'{0}-349'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'{0}-374'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'{0}-399'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'{0}-424'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'{0}-449'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'{0}-474'</span><span style='color:#d2cd86; '>,</span> <span style='color:#00c4c4; '>'{0}-499'</span><span style='color:#d2cd86; '>]</span>
<span style='color:#e66170; font-weight:bold; '>for</span> m <span style='color:#e66170; font-weight:bold; '>in</span> models<span style='color:#d2cd86; '>[</span><span style='color:#00a800; '>3</span><span style='color:#d2cd86; '>:</span><span style='color:#d2cd86; '>]</span><span style='color:#d2cd86; '>:</span>
    rin <span style='color:#d2cd86; '>=</span> Cyto<span style='color:#d2cd86; '>(</span>m<span style='color:#d2cd86; '>,</span> out_path<span style='color:#d2cd86; '>=</span>outp<span style='color:#d2cd86; '>,</span> pdb_path<span style='color:#d2cd86; '>=</span>pdbp<span style='color:#d2cd86; '>)</span>
    rin<span style='color:#d2cd86; '>.</span>NetNames <span style='color:#d2cd86; '>=</span> <span style='color:#d2cd86; '>[</span>s<span style='color:#d2cd86; '>.</span>format<span style='color:#d2cd86; '>(</span>m<span style='color:#d2cd86; '>)</span> <span style='color:#e66170; font-weight:bold; '>for</span> s <span style='color:#e66170; font-weight:bold; '>in</span> NetNames<span style='color:#d2cd86; '>]</span>
    
    <span style='color:#9999a9; '># use port 5492</span>
    rin<span style='color:#d2cd86; '>.</span>OpenPDBs_Chimera<span style='color:#d2cd86; '>(</span><span style='color:#00a800; '>5492</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#9999a9; '># compute centrality </span>
    rin<span style='color:#d2cd86; '>.</span>FullCentrality<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span>
    
    <span style='color:#9999a9; '># plot (delta) betweenness centrality z-scores</span>
    rin<span style='color:#d2cd86; '>.</span>multi_bca<span style='color:#d2cd86; '>(</span>models<span style='color:#d2cd86; '>)</span>
</pre>
<!--Created using ToHtml.com on 2021-12-25 16:57:38 UTC -->